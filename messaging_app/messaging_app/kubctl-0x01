#!/bin/bash

DEPLOYMENT_NAME="django-app-deployment"
REPLICAS=3

echo "1. Scaling deployment '$DEPLOYMENT_NAME' to $REPLICAS replicas..."
# Scales the Deployment to 3 copies
kubectl scale deployment $DEPLOYMENT_NAME --replicas=$REPLICAS

echo "--------------------------------------------------------"
echo "2. Verifying multiple pods are running (this may take a minute)..."
# Wait for the deployment to reach the desired state (3 running pods)
kubectl wait --for=condition=Available deployment/$DEPLOYMENT_NAME --timeout=60s
kubectl get pods -l app=django-app

echo "--------------------------------------------------------"
echo "3. Enabling Minikube metrics-server (required for kubectl top)..."
# This addon is necessary for 'kubectl top' to work (Task 2 requirement)
minikube addons enable metrics-server

# Monitors Resource Usage
echo "4. Current resource usage across the $REPLICAS pods (may take 30s for metrics to appear):"
kubectl top pod -l app=django-app

echo "Scaling and basic monitoring complete."